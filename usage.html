<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H3 Turbo (SYCL Bridge) - Usage Guide</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }
        .sidebar {
            background-color: #fff;
            padding: 20px;
            border-right: 1px solid #dee2e6;
            height: 100vh;
            position: sticky;
            top: 0;
            overflow-y: auto;
        }
        .content {
            padding: 40px;
        }
        h1, h2, h3 {
            color: #2c3e50;
            margin-top: 1.5rem;
        }
        h1 {
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }
        code {
            background-color: #f1f3f5;
            padding: 2px 5px;
            border-radius: 4px;
            color: #d63384;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        pre {
            background-color: #282c34;
            color: #abb2bf;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
        }
        .nav-link {
            color: #495057;
        }
        .nav-link.active {
            font-weight: bold;
            color: #0d6efd;
        }
        .alert-info {
            border-left: 5px solid #0d6efd;
        }
        .footer {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
            color: #6c757d;
        }
    </style>
</head>
<body>

<div class="container-fluid">
    <div class="row">
        <!-- Sidebar Navigation -->
        <div class="col-md-3 col-lg-2 sidebar d-none d-md-block">
            <h4 class="mb-4">H3 Turbo</h4>
            <nav class="nav flex-column">
                <a class="nav-link active" href="#overview">Overview</a>
                <a class="nav-link" href="#installation">Installation</a>
                <a class="nav-link" href="#licensing">Licensing</a>
                <a class="nav-link" href="#api-reference">API Reference</a>
                <a class="nav-link" href="#examples">Examples</a>
                <a class="nav-link" href="#benchmarks">Benchmarks</a>
                <a class="nav-link" href="#troubleshooting">Troubleshooting</a>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="col-md-9 col-lg-10 content">
            
            <section id="overview">
                <h1>H3 Turbo Usage Guide</h1>
                <p class="lead">
                    Accelerate your H3 geospatial indexing and spatial joins using SYCL-based GPU acceleration.
                </p>
                <p>
                    <strong>H3 Turbo</strong> Python bindings for high-performance H3 operations, 
                    offloading heavy computations to the GPU. It is designed for massive datasets where standard CPU-based H3 libraries become a bottleneck.
                </p>
            </section>

            <section id="installation">
                <h2>Installation</h2>
                
                <div class="card mb-3">
                    <div class="card-body">
                        <pre><code>

# Install the package
sudo ./h3_turbo_installer.sh</code></pre>
                    </div>
                </div>
            </section>

            <section id="licensing">
                <h2>Licensing</h2>
                <p>
                    H3 Turbo requires a valid license key to operate. You must set the <code>H3_TURBO_LICENSE</code> environment variable 
                    or set it programmatically before calling API functions.
                </p>
                <div class="alert alert-info">
                    Get a 1 month license key <a href="mailto:info@fluidgeo.com">here</a>.
                </div>
                <pre><code>import os
import h3_turbo

# Option 1: Set via Environment Variable (Recommended)
# export H3_TURBO_LICENSE="LICENSE-USER-EXP-SIGNATURE"

# Option 2: Set Programmatically
h3_turbo.set_license_key("YOUR_LICENSE_KEY_HERE")</code></pre>
            </section>

            <section id="api-reference">
                <h2>API Reference</h2>
                <p>The library exposes several key functions optimized for batch processing.</p>

                <h4><code>latlng_to_cell(lats, lngs, res)</code></h4>
                <p>Converts arrays of latitude/longitude pairs to H3 cell indices.</p>
                <ul>
                    <li><strong>lats</strong>: Numpy array of latitudes.</li>
                    <li><strong>lngs</strong>: Numpy array of longitudes.</li>
                    <li><strong>res</strong>: H3 resolution (0-15).</li>
                </ul>

                <h4><code>spatial_join(pings, zones, res_target)</code></h4>
                <p>Performs a high-speed point-in-polygon (or point-in-set) check.</p>
                <ul>
                    <li><strong>pings</strong>: Numpy array of H3 indices (the points to check).</li>
                    <li><strong>zones</strong>: Numpy array of H3 indices (the "hot zones" or target areas).</li>
                    <li><strong>res_target</strong>: The resolution at which to perform the containment check.</li>
                </ul>
            </section>

            <section id="examples">
                <h2>Examples</h2>
                
                <h3>1. Batch Point Indexing</h3>
                <pre><code>import h3_turbo
import numpy as np

# Generate dummy data
lats = np.random.uniform(37.7, 37.8, 1000000)
lngs = np.random.uniform(-122.5, -122.4, 1000000)
resolution = 9

# Run on GPU
cells = h3_turbo.latlng_to_cell(lats, lngs, resolution)

print(f"Indexed {len(cells)} points.")</code></pre>

                <h3>2. Spatial Join (Geofencing)</h3>
                <pre><code>import h3_turbo
import numpy as np

# Load your data (e.g., from Parquet or CSV)
pings = np.load("pings.npy")  # Array of H3 indices
zones = np.load("zones.npy")  # Array of H3 indices (geofences)

# Perform the join at resolution 7
results = h3_turbo.spatial_join(pings, zones, 7)

# results[i] is 1 if pings[i] is inside any zone, 0 otherwise
matches = np.sum(results)
print(f"Found {matches} pings inside the zones.")</code></pre>
            </section>


            <section id="troubleshooting">
                <h2>Troubleshooting</h2>
                
                <h4>Memory Issues (SIGKILL)</h4>
                <p>
                    If you encounter a <code>SIGKILL</code> or crash during large benchmarks (e.g., >1 Billion points), 
                    it is likely due to running out of host RAM or GPU memory.
                </p>
                <ul>
                    <li><strong>Solution:</strong> The library attempts to manage batch sizes dynamically. Ensure you have sufficient swap space or reduce the input size.</li>
                </ul>
            </section>

        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>